{% assign video_title = product.metafields.custom.video_title %}
{% assign video_description = product.metafields.custom.video_description %}

{% assign link_1 = product.metafields.custom.video_slider_link_1 %}
{% assign image_1 = product.metafields.custom.video_slider_image_1 %}

{% assign link_2 = product.metafields.custom.video_slider_link_2 %}
{% assign image_2 = product.metafields.custom.video_slider_image_2 %}

{% assign link_3 = product.metafields.custom.video_slider_link_3 %}
{% assign image_3 = product.metafields.custom.video_slider_image_3 %}

{% assign link_4 = product.metafields.custom.video_slider_link_4 %}
{% assign image_4 = product.metafields.custom.video_slider_image_4 %}

<div class="video-slider-section container">
  <h2>{{ video_title }}</h2>
  <p>{{ video_description }} </p>

  <div class="video-slider">
    {% if link_1 %}
      <div class="video-slide">
        <div class="video-wrapper">
          <video
            autoplay
            preload="none"
            playsinline
            poster="{{ image_1 | img_url: 'master' }}"
          >
            <source src="{{ link_1 }}" type="video/mp4">
          </video>
          <button class="custom-play-btn">
          <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2">
    <path d="M3 2L21 12L3 22Z"/>
  </svg>
          </button>
        </div>
      </div>
    {% endif %}

    {% if link_2 %}
      <div class="video-slide">
        <div class="video-wrapper">
          <video
            autoplay
            preload="none"
            playsinline
            poster="{{ image_2 | img_url: 'master' }}"
          >
            <source src="{{ link_2 }}" type="video/mp4">
          </video>
          <button class="custom-play-btn">
        <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2">
    <path d="M3 2L21 12L3 22Z"/>
  </svg>
          </button>
        </div>
      </div>
    {% endif %}

    {% if link_3 %}
      <div class="video-slide">
        <div class="video-wrapper">
          <video
            autoplay
            preload="none"
            playsinline
            poster="{{ image_3 | img_url: 'master' }}"
          >
            <source src="{{ link_3 }}" type="video/mp4">
          </video>
          <button class="custom-play-btn">
             <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2">
    <path d="M3 2L21 12L3 22Z"/>
  </svg>
          </button>
        </div>
      </div>
    {% endif %}

    {% if link_4 %}
      <div class="video-slide">
        <div class="video-wrapper">
          <video
            autoplay
            preload="none"
            playsinline
            poster="{{ image_4 | img_url: 'master' }}"
          >
            <source src="{{ link_4 }}" type="video/mp4">
          </video>
          <button class="custom-play-btn">
             <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2">
    <path d="M3 2L21 12L3 22Z"/>
  </svg>
          </button>
        </div>
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Video Slider",
  "tag": "section",
  "class": "video-slider-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "How our customers use our products?"
    }
  ],
  "blocks": [
    {
      "type": "Slide",
      "name": "Video Slide",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "video",
          "label": "Upload Shopify-hosted video"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Video Slider",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.js"></script>

<script>

// ‚≠ê‚≠ê‚≠ê PLAY / PAUSE + PAUSE OTHER VIDEOS
function initVideoButtons() {
  const wrappers = document.querySelectorAll('.video-wrapper');

  wrappers.forEach(wrapper => {
    const video = wrapper.querySelector('video');
    const btn = wrapper.querySelector('.custom-play-btn');

    if (!btn || !video) return;

    const playIcon = `
      <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2">
        <path d="M3 2L21 12L3 22Z"/>
      </svg>
    `;

    const pauseIcon = `
      <svg width="40px" height="40px" viewBox="0 0 24 24" fill="#000">
        <rect x="6" y="4" width="4" height="16"/>
        <rect x="14" y="4" width="4" height="16"/>
      </svg>
    `;

    btn.innerHTML = playIcon;

    btn.addEventListener('click', () => {

      // üî• PAUSE ALL OTHER VIDEOS
      wrappers.forEach(w => {
        const v = w.querySelector('video');
        const b = w.querySelector('.custom-play-btn');
        if (v !== video) {
          v.pause();
          w.classList.remove('playing');
          b.innerHTML = playIcon;
        }
      });

      // Play or pause current
      if (video.paused) {
        video.play();
        wrapper.classList.add('playing');
        btn.innerHTML = pauseIcon;
      } else {
        video.pause();
        wrapper.classList.remove('playing');
        btn.innerHTML = playIcon;
      }
    });

    video.addEventListener('ended', () => {
      wrapper.classList.remove('playing');
      btn.innerHTML = playIcon;
    });
  });
}


// ‚≠ê‚≠ê‚≠ê INITIALIZE SLICK SLIDER
$('.video-slider').on('init', function () {
  initVideoButtons();
});



// ‚≠ê‚≠ê‚≠ê RE-INIT AFTER SLIDE CHANGE (slick clones slides)
$('.video-slider').on('afterChange', function () {
  initVideoButtons();
});

</script>
<script>
  
$('.video-slider').slick({
  slidesToShow: 3,
  slidesToScroll: 1,
  arrows: true,
  dots: false,
  infinite: true,

  responsive: [
    {
      breakpoint: 991,
      settings: { slidesToShow: 3 }
    },
    {
      breakpoint: 767,
      settings: { slidesToShow: 1 }
    }
  ]
});
</script>
<style>
  .video-wrapper {
    position: relative;
    width: 100%;
  }

  .custom-play-btn {
        position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      padding: 20px 28px;
      font-size: 28px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 2;
      opacity: 1;
      height: 85px;
      transition: opacity 0.25s
  ease;
      width: 85px;
      display: flex;
      align-items: center;
      justify-content: center;
  }

  /* Hide button while video is playing */
  .video-wrapper.playing .custom-play-btn {
    opacity: 0;
    pointer-events: none;
  }

  /* Show on hover when paused */
  .video-wrapper:hover .custom-play-btn {
    opacity: 1;
    pointer-events: auto;
  }

  .video-wrapper video {
    width: 100%;
    display: block;
    pointer-events: none;
  }
  button.custom-play-btn svg path {
    fill: #fff;
    color: #fff;
    stroke: #fff;
}

button.custom-play-btn svg {
    height: 30px;
    width: 30px;
        fill: #fff;
    color: #fff;
    stroke: #fff;
}

.video-wrapper playing svg {
    height: 50px;
    width: 50px;
}

.video-wrapper.playing button.custom-play-btn {
    padding: 0;
}

.video-wrapper.playing svg {
    height: 40px;
    width: 40px;
}

</style>
